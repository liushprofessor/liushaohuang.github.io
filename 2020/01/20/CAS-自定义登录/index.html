<!DOCTYPE html>





<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.3.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.3.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.3.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.3.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="简介CAS提供了单点登录服务功能，但是默认只使用账号密码登录，在现实项目中往往需要添加各种验证因子比如短信和验证码等，通过对源码的跟踪和分析这边简介一下CAS登录验证逻辑的大致流程和如何定制登录代码.">
<meta name="keywords" content="CAS">
<meta property="og:type" content="article">
<meta property="og:title" content="CAS教程2-自定义登录">
<meta property="og:url" content="http://www.liushaohuang.cn/2020/01/20/CAS-自定义登录/index.html">
<meta property="og:site_name" content="刘绍煌">
<meta property="og:description" content="简介CAS提供了单点登录服务功能，但是默认只使用账号密码登录，在现实项目中往往需要添加各种验证因子比如短信和验证码等，通过对源码的跟踪和分析这边简介一下CAS登录验证逻辑的大致流程和如何定制登录代码.">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2020-01-21T08:42:13.378Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CAS教程2-自定义登录">
<meta name="twitter:description" content="简介CAS提供了单点登录服务功能，但是默认只使用账号密码登录，在现实项目中往往需要添加各种验证因子比如短信和验证码等，通过对源码的跟踪和分析这边简介一下CAS登录验证逻辑的大致流程和如何定制登录代码.">
  <link rel="canonical" href="http://www.liushaohuang.cn/2020/01/20/CAS-自定义登录/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>CAS教程2-自定义登录 | 刘绍煌</title>
  <meta name="generator" content="Hexo 3.9.0">
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <div class="container use-motion">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">刘绍煌</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-tags">
      
    

    <a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-categories">
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
            

          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
      <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block post">
    <link itemprop="mainEntityOfPage" href="http://www.liushaohuang.cn/2020/01/20/CAS-自定义登录/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘绍煌">
      <meta itemprop="description" content="刘绍煌的个人博客">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘绍煌">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">CAS教程2-自定义登录

          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2020-01-20 10:55:28" itemprop="dateCreated datePublished" datetime="2020-01-20T10:55:28+08:00">2020-01-20</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-01-21 16:42:13" itemprop="dateModified" datetime="2020-01-21T16:42:13+08:00">2020-01-21</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/CAS/" itemprop="url" rel="index"><span itemprop="name">CAS</span></a></span>

                
                
              
            </span>
          

          
            <span class="post-meta-item" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p>CAS提供了单点登录服务功能，但是默认只使用账号密码登录，在现实项目中往往需要添加各种验证因子比如短信和验证码等，通过对源码的跟踪和分析这边简介一下CAS登录验证逻辑的大致流程和如何定制登录代码.</p>
<a id="more"></a>

<h4 id="前置学习条件"><a href="#前置学习条件" class="headerlink" title="前置学习条件"></a>前置学习条件</h4><p>CAS 是使用 Spring Web Flow 和 Thymeleaf来实现登录页面的  Thymeleaf  是一个模板渲染引擎，这部分和jsp有一点点类似，只要接触过 MVC 架构这一块就没有太大问题，在跟踪代码问题中主要问题在 Spring Web Flow 需要对Spring Web Flow的基础概念有一定的了解才能大致了解源码的运行流畅和自定义登录代码，Spring Web Flow的基础概念，只要了解了基础概念定制 CAS 的登录就不会有太大问题：一下是之前写的关于 Spring Web Flow  的基础概念的文档<br><a href="https://liushaohuang.cn/2020/01/17/Spring-Web-flow-%E6%A6%82%E5%BF%B5%E7%AE%80%E4%BB%8B/" target="_blank" rel="noopener">https://liushaohuang.cn/2020/01/17/Spring-Web-flow-%E6%A6%82%E5%BF%B5%E7%AE%80%E4%BB%8B/</a></p>
<h4 id="找到入口Flow-入口"><a href="#找到入口Flow-入口" class="headerlink" title="找到入口Flow 入口"></a>找到入口Flow 入口</h4><ul>
<li>我使用CAS 官方提供的 overlays 项目来构建 CAS Service<br><a href="https://github.com/apereo/cas-overlay-template/tree/5.3" target="_blank" rel="noopener">https://github.com/apereo/cas-overlay-template/tree/5.3</a>  </li>
</ul>
<ul>
<li><p>在代码编译起来后在 overlays/org.apereo.cas.cas-server-webapp-tomcat-5.3.1/WEB-INF/webflow/login/  目录下我们可以找到login-webflow.xml 这个文件就是配置登录的 Flow的地方</p>
</li>
<li><p>login-webflow.xml的初始代码如下:这里我们可以看见这里定义了一个flow 里面包含两个 action-state 和 一个 view-state 他们之间根据Flow执行的状态相互跳转  </p>
<ol>
<li><p>initializeLoginForm : 进入这个 state 后会调用一个注入到Spring容器中的 initializeLoginAction 对象如果它返回的Event是 success的话就跳转到 viewLoginForm state</p>
</li>
<li><p>viewLoginForm : 进入这个 state 后会自动跳转到 WEB-INF/templates 目录下的 casLoginView 这个页面，这里我们可以看到这个页面还绑定了一个credential 对象，字段名分别为username，password，具体在哪里绑定的看到这里我们还不懂，这部分后面再看，然后还有一个submit的事件，触发后跳转到 realSubmit state</p>
</li>
<li><p>realSubmit : 这部分和 initializeLoginForm 没有太大区别，就是进入这个state后调用 authenticationViaFormAction 然后根据返回值跳转到不同的地方，但是跳转的除了 initializeLoginForm，其它的跳转在xml中一概没有标识看，这部分我们后面再看。</p>
</li>
</ol>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;flow xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">      xmlns=&quot;http://www.springframework.org/schema/webflow&quot;</span><br><span class="line">      xsi:schemaLocation=&quot;http://www.springframework.org/schema/webflow</span><br><span class="line">                          http://www.springframework.org/schema/webflow/spring-webflow.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;action-state id=&quot;initializeLoginForm&quot;&gt;</span><br><span class="line">        &lt;evaluate expression=&quot;initializeLoginAction&quot; /&gt;</span><br><span class="line">        &lt;transition on=&quot;success&quot; to=&quot;viewLoginForm&quot;/&gt;</span><br><span class="line">    &lt;/action-state&gt;</span><br><span class="line"></span><br><span class="line">    &lt;view-state id=&quot;viewLoginForm&quot; view=&quot;casLoginView&quot; model=&quot;credential&quot;&gt;</span><br><span class="line">        &lt;binder&gt;</span><br><span class="line">            &lt;binding property=&quot;username&quot; required=&quot;true&quot;/&gt;</span><br><span class="line">            &lt;binding property=&quot;password&quot; required=&quot;true&quot;/&gt;</span><br><span class="line">        &lt;/binder&gt;</span><br><span class="line">        &lt;transition on=&quot;submit&quot; bind=&quot;true&quot; validate=&quot;true&quot; to=&quot;realSubmit&quot; history=&quot;invalidate&quot;/&gt;</span><br><span class="line">    &lt;/view-state&gt;</span><br><span class="line"></span><br><span class="line">    &lt;action-state id=&quot;realSubmit&quot;&gt;</span><br><span class="line">        &lt;evaluate expression=&quot;authenticationViaFormAction&quot;/&gt;</span><br><span class="line">        &lt;transition on=&quot;warn&quot; to=&quot;warn&quot;/&gt;</span><br><span class="line">        &lt;transition on=&quot;success&quot; to=&quot;createTicketGrantingTicket&quot;/&gt;</span><br><span class="line">        &lt;transition on=&quot;successWithWarnings&quot; to=&quot;showAuthenticationWarningMessages&quot;/&gt;</span><br><span class="line">        &lt;transition on=&quot;authenticationFailure&quot; to=&quot;handleAuthenticationFailure&quot;/&gt;</span><br><span class="line">        &lt;transition on=&quot;error&quot; to=&quot;initializeLoginForm&quot;/&gt;</span><br><span class="line">    &lt;/action-state&gt;</span><br><span class="line">&lt;/flow&gt;</span><br></pre></td></tr></table></figure>

<h4 id="CAS-M和V的绑定"><a href="#CAS-M和V的绑定" class="headerlink" title="CAS M和V的绑定"></a>CAS M和V的绑定</h4><p>CAS 使用 Spring Web Flow 完成 MVC 的 M 和 V 的绑定<br>我们首先在官网上找到如何配置自定义的Flow的方法  </p>
<p><a href="https://apereo.github.io/cas/5.3.x/installation/Webflow-Customization-Extensions.html" target="_blank" rel="noopener">https://apereo.github.io/cas/5.3.x/installation/Webflow-Customization-Extensions.html</a>  </p>
<p>我们通过在网上找到的其它文档发现 CAS 实现登录逻辑是在 DefaultLoginWebflowConfigurer类下，部分源码如下,我们根据方法名可以看到其在初始化时,好像配置了一系列的东西，比如createDefaultActionStates 方法，我们可以猜想到其又在 xml 的基础上用java代码的方式创建了很多 action state，这就解释了为什么上一步中我们在 realSubmit 下配置的跳转信息在xml中没有</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public class DefaultLoginWebflowConfigurer extends AbstractCasWebflowConfigurer &#123;</span><br><span class="line"></span><br><span class="line">    protected void doInitialize() &#123;</span><br><span class="line">        Flow flow = this.getLoginFlow();</span><br><span class="line">        if (flow != null) &#123;</span><br><span class="line">            this.createInitialFlowActions(flow);</span><br><span class="line">            this.createDefaultGlobalExceptionHandlers(flow);</span><br><span class="line">            this.createDefaultEndStates(flow);</span><br><span class="line">            this.createDefaultDecisionStates(flow);</span><br><span class="line">            this.createDefaultActionStates(flow);</span><br><span class="line">            this.createDefaultViewStates(flow);</span><br><span class="line">            this.createRememberMeAuthnWebflowConfig(flow);</span><br><span class="line">            this.setStartState(flow, &quot;initialAuthenticationRequestValidationCheck&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>我们这里先不管具体的逻辑，我们主要找到入口，在源码中全局搜索 DefaultLoginWebflowConfigurer 我们会找到一个 CasWebflowContextConfiguration的配置类,部分源码如下，我只复制了我感兴趣的代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">@Configuration(&quot;casWebflowContextConfiguration&quot;)</span><br><span class="line">@EnableConfigurationProperties(CasConfigurationProperties.class)</span><br><span class="line">@Slf4j</span><br><span class="line">public class CasWebflowContextConfiguration &#123;</span><br><span class="line"></span><br><span class="line">  @Bean</span><br><span class="line">    public FlowDefinitionRegistry loginFlowRegistry() &#123;</span><br><span class="line">        final FlowDefinitionRegistryBuilder builder = new FlowDefinitionRegistryBuilder(this.applicationContext, builder());</span><br><span class="line">        builder.setBasePath(BASE_CLASSPATH_WEBFLOW);</span><br><span class="line">        builder.addFlowLocationPattern(&quot;/login/*-webflow.xml&quot;);</span><br><span class="line">        return builder.build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @ConditionalOnMissingBean(name = &quot;defaultWebflowConfigurer&quot;)</span><br><span class="line">    @Bean</span><br><span class="line">    @Order(0)</span><br><span class="line">    @RefreshScope</span><br><span class="line">    public CasWebflowConfigurer defaultWebflowConfigurer() &#123;</span><br><span class="line">        final DefaultLoginWebflowConfigurer c = new DefaultLoginWebflowConfigurer(builder(), loginFlowRegistry(), applicationContext, casProperties);</span><br><span class="line">        c.setLogoutFlowDefinitionRegistry(logoutFlowRegistry());</span><br><span class="line">        c.setOrder(Ordered.HIGHEST_PRECEDENCE);</span><br><span class="line">        return c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @ConditionalOnMissingBean(name = &quot;casDefaultWebflowExecutionPlanConfigurer&quot;)</span><br><span class="line">    @Bean</span><br><span class="line">    public CasWebflowExecutionPlanConfigurer casDefaultWebflowExecutionPlanConfigurer() &#123;</span><br><span class="line">        return new CasWebflowExecutionPlanConfigurer() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void configureWebflowExecutionPlan(final CasWebflowExecutionPlan plan) &#123;</span><br><span class="line">                plan.registerWebflowConfigurer(defaultWebflowConfigurer());</span><br><span class="line">                plan.registerWebflowConfigurer(defaultLogoutWebflowConfigurer());</span><br><span class="line">                plan.registerWebflowConfigurer(groovyWebflowConfigurer());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>loginFlowRegistry()  </p>
<p>之前关于 Spring Web Flow 的文章中提过 Flow 是通过Registry去管理的，CAS 对 Spring Web Flow进行了二次封装，这里在 Spring 中注册了Registry，并且将 /login 下的xml注册到  Registry中，进入 builder.build() 方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public FlowDefinitionRegistry build() &#123;</span><br><span class="line">        DefaultFlowRegistry flowRegistry = new DefaultFlowRegistry();</span><br><span class="line">        flowRegistry.setParent(this.parent);</span><br><span class="line">        this.registerFlowLocations(flowRegistry);</span><br><span class="line">        this.registerFlowLocationPatterns(flowRegistry);</span><br><span class="line">        this.registerFlowBuilders(flowRegistry);</span><br><span class="line">        return flowRegistry;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>我们再进入this.registerFlowLocations(flowRegistry); 这里注意一点<br><strong>this.flowResourceFactory.createResource(path, attributes, id); 方法将flow 的xml的路径当做id保存在  FlowDefinitionResource中（如 WEB-INF/webflow/login/login-webflow.xml 的id为login），这个id将会被当做 Flow 的id在 flowRegistry中注册</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">private void registerFlowLocations(DefaultFlowRegistry flowRegistry) &#123;</span><br><span class="line">        Iterator var2 = this.flowLocations.iterator();</span><br><span class="line"></span><br><span class="line">        while(var2.hasNext()) &#123;</span><br><span class="line">            FlowDefinitionRegistryBuilder.FlowLocation location = (FlowDefinitionRegistryBuilder.FlowLocation)var2.next();</span><br><span class="line">            String path = location.getPath();</span><br><span class="line">            String id = location.getId();</span><br><span class="line">            AttributeMap&lt;Object&gt; attributes = location.getAttributes();</span><br><span class="line">            this.updateFlowAttributes(attributes);</span><br><span class="line">            FlowDefinitionResource resource = this.flowResourceFactory.createResource(path, attributes, id);</span><br><span class="line">            this.registerFlow(resource, flowRegistry);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>我们发现 this.registerFlow(resource, flowRegistry); 很有可能是注册逻辑的代码，进入查看,发现  flowRegistry.getFlowModelRegistry().registerFlowModel(resource.getId(), flowModelHolder);这一行代码中将resource的id当做flow的id在flowRegistry中注册，至此我们在overlays下定义的 login-webflow.xml 就已经完成注册</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">private void registerFlow(FlowDefinitionResource resource, DefaultFlowRegistry flowRegistry) &#123;</span><br><span class="line"></span><br><span class="line">       if (resource.getPath().getFilename().endsWith(&quot;.xml&quot;)) &#123;</span><br><span class="line">           FlowModelBuilder flowModelBuilder = new XmlFlowModelBuilder(resource.getPath(), flowRegistry.getFlowModelRegistry());</span><br><span class="line">           DefaultFlowModelHolder flowModelHolder = new DefaultFlowModelHolder(flowModelBuilder);</span><br><span class="line">           FlowModelFlowBuilder flowBuilder = new FlowModelFlowBuilder(flowModelHolder);</span><br><span class="line">           FlowBuilderContextImpl builderContext = new FlowBuilderContextImpl(resource.getId(), resource.getAttributes(), flowRegistry, this.flowBuilderServices);</span><br><span class="line">           FlowAssembler assembler = new FlowAssembler(flowBuilder, builderContext);</span><br><span class="line">           DefaultFlowHolder flowHolder = new DefaultFlowHolder(assembler);</span><br><span class="line">           flowRegistry.getFlowModelRegistry().registerFlowModel(resource.getId(), flowModelHolder);</span><br><span class="line">           flowRegistry.registerFlowDefinition(flowHolder);</span><br><span class="line">       &#125; else &#123;</span><br><span class="line">           throw new IllegalArgumentException(resource + &quot; is not a supported resource type; supported types are [.xml]&quot;);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>defaultWebflowConfigurer()</p>
<p>这个方法是对之前我们在 xml 中编写的 login-webflow.xml flow做扩展，上面有一个注解@ConditionalOnMissingBean(name = “defaultWebflowConfigurer”) 代表代码执行到这里时，Spring 容器你没有 defaultWebflowConfigurer 对象的话才进行装配，而@Order(0)注解又指定了这个类装配的优先级，那么我们到这里就有思路了<strong>要实现登录的主要逻辑，我们可以在这个类进行装配前，自己实现一个defaultWebflowConfigurer，里面包含我们自己的登录逻辑</strong>,我们进入 DefaultLoginWebflowConfigurer 查看一下具体的逻辑</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">  public class DefaultLoginWebflowConfigurer extends AbstractCasWebflowConfigurer &#123;</span><br><span class="line"></span><br><span class="line">        protected void doInitialize() &#123;</span><br><span class="line">            Flow flow = this.getLoginFlow();</span><br><span class="line">            if (flow != null) &#123;</span><br><span class="line">                this.createInitialFlowActions(flow);</span><br><span class="line">                this.createDefaultGlobalExceptionHandlers(flow);</span><br><span class="line">                this.createDefaultEndStates(flow);</span><br><span class="line">                this.createDefaultDecisionStates(flow);</span><br><span class="line">                this.createDefaultActionStates(flow);</span><br><span class="line">                this.createDefaultViewStates(flow);</span><br><span class="line">                this.createRememberMeAuthnWebflowConfig(flow);</span><br><span class="line">                this.setStartState(flow, &quot;initialAuthenticationRequestValidationCheck&quot;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>this.getLoginFlow(); 方法是从我们上一步FlowRegistry中注册的 login-webflow.xml 中取出 Flow,然后之后对这个 Flow 用代码调用API的方式手动增加了许多 state，这里就解释了我们最早看到的 login-webflow.xml 中很多跳转并没有配置 state，原因就在这里，那些跳转的 state 全部都在这里完成写入，我们重点注意一下 this.createRememberMeAuthnWebflowConfig(flow); 和 this.setStartState(flow, “initialAuthenticationRequestValidationCheck”);方法</p>
</li>
<li><p>this.createRememberMeAuthnWebflowConfig(flow);    </p>
<p>我们重点看下 else 中的逻辑，这里在 flow 中创建了一个 credential 变量并和 UsernamePasswordCredential.class 对象做绑定，我们可以重新查看一下 login-webflow.xml ，<strong>发现 viewLoginForm 标签中有一个 modal 参数就是和 credential做绑定的，这里和UsernamePasswordCredential.class对象做了绑定，而 UsernamePasswordCredential 又是实现了 Credential 接口，那么这里思路就很明确了，我们 继承 DefaultLoginWebflowConfigurer 重写 createRememberMeAuthnWebflowConfig 方法将我们自定义的 Credential对象和 login-webflow.xml 中的 credential  做绑定 ，这样我们就完成了 MVC 中的 M 和 V 的绑定</strong></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">protected void createRememberMeAuthnWebflowConfig(Flow flow) &#123;</span><br><span class="line">      if (this.casProperties.getTicket().getTgt().getRememberMe().isEnabled()) &#123;</span><br><span class="line">          this.createFlowVariable(flow, &quot;credential&quot;, RememberMeUsernamePasswordCredential.class);</span><br><span class="line">          ViewState state = (ViewState)this.getState(flow, &quot;viewLoginForm&quot;, ViewState.class);</span><br><span class="line">          BinderConfiguration cfg = this.getViewStateBinderConfiguration(state);</span><br><span class="line">          cfg.addBinding(new Binding(&quot;rememberMe&quot;, (String)null, false));</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">          this.createFlowVariable(flow, &quot;credential&quot;, UsernamePasswordCredential.class);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>this.setStartState(flow, “initialAuthenticationRequestValidationCheck”)</p>
<p>这个方法给 login Flow 设置了一个 on-start 标签。之前我手动尝试在 login-webflow.xml 中配置一个 on-start 标签，但是发现无论怎么也无法执行，后来查看源码发现这里重新设置了 on-start 标签的内容，这里关联到 initialAuthenticationRequestValidationCheck 标签，initialAuthenticationRequestValidationCheck标签是前面 this.createDefaultActionStates(flow); 中创建的，如果有兴趣可以根据代码中的每一个Action 会发现最后其会关联到我们在 login-webflow.xml 中定义的initializeLoginForm 标签，<strong>官网文档中有提到，不要轻易手动修改 login-webflow.xml 中的标签，除非你知道他干什么，看到这里就已经基本明白了，xml定义的标签都是会和这里新增的 state 做关联的。</strong></p>
<h4 id="自定义-CAS-M和V的绑定"><a href="#自定义-CAS-M和V的绑定" class="headerlink" title="自定义 CAS M和V的绑定"></a>自定义 CAS M和V的绑定</h4></li>
<li><p>自定义Credential</p>
<p>  根据上一节的思路，我们自定义绑定 M 和 V,首先我们要实现一个 Credential 对象，这个对象是用来 M 和 V 做绑定的参数，类似我们 Spring MVC Controller 层的参数,我们这里选择直接继承 UsernamePasswordCredential，因为 UsernamePasswordCredential 实现了 Credential我们在其中扩展了一个code字段.<strong>注意必须添加一个空的构造，不然绑定会发生错误</strong></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public class MyUsernamePasswordCredential extends UsernamePasswordCredential &#123;</span><br><span class="line"></span><br><span class="line">    public MyUsernamePasswordCredential(String username, String password, String code) &#123;</span><br><span class="line">        super(username, password);</span><br><span class="line">        this.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //必须添加空参构造，不然Web Flow无法注入</span><br><span class="line">    public MyUsernamePasswordCredential() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private String code;</span><br><span class="line"></span><br><span class="line">    public String getCode() &#123;</span><br><span class="line">        return code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setCode(String code) &#123;</span><br><span class="line">        this.code = code;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>自定义  CasWebflowConfigurer</p>
<p>我们这里直接继承 DefaultLoginWebflowConfigurer 重写 createRememberMeAuthnWebflowConfig 方法即可,我们将credential变量绑定给了我们自定义的 MyUsernamePasswordCredential 对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">  public class MyLoginWebflowConfiger extends DefaultLoginWebflowConfigurer &#123;</span><br><span class="line"></span><br><span class="line">    public MyLoginWebflowConfiger(FlowBuilderServices flowBuilderServices, FlowDefinitionRegistry flowDefinitionRegistry, ApplicationContext applicationContext, CasConfigurationProperties casProperties) &#123;</span><br><span class="line">        super(flowBuilderServices, flowDefinitionRegistry, applicationContext, casProperties);</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    protected void createRememberMeAuthnWebflowConfig(Flow flow)&#123;</span><br><span class="line"></span><br><span class="line">        if (this.casProperties.getTicket().getTgt().getRememberMe().isEnabled()) &#123;</span><br><span class="line">            this.createFlowVariable(flow, &quot;credential&quot;, RememberMeUsernamePasswordCredential.class);</span><br><span class="line">            ViewState state = (ViewState)this.getState(flow, &quot;viewLoginForm&quot;, ViewState.class);</span><br><span class="line">            BinderConfiguration cfg = this.getViewStateBinderConfiguration(state);</span><br><span class="line">            cfg.addBinding(new BinderConfiguration.Binding(&quot;rememberMe&quot;, (String)null, false));</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            this.createFlowVariable(flow, &quot;credential&quot;, MyUsernamePasswordCredential.class);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>注册自定义 CasWebflowConfigurer</p>
<p>我们模仿CasWebflowContextConfiguration 将我们自定义的 MyLoginWebflowConfiger注入到Spring中,注意一下我们使用@Order(-1)注解来标识我们的defaultWebflowConfigurer() 对象 在默认 的 defaultWebflowConfigurer() 对象之前注入到 Spring 中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">@EnableConfigurationProperties(&#123;CasConfigurationProperties.class&#125;)</span><br><span class="line">public class CASWebFlowConfig implements CasWebflowExecutionPlanConfigurer&#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private FlowBuilderServices flowBuilderServices;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    @Qualifier(&quot;loginFlowRegistry&quot;)</span><br><span class="line">    private FlowDefinitionRegistry loginFlowRegistry;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    @Qualifier(&quot;logoutFlowRegistry&quot;)</span><br><span class="line">    FlowDefinitionRegistry logoutFlowRegistry;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private ApplicationContext applicationContext;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private CasConfigurationProperties casProperties;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private ServicesManager servicesManager;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    @Order(-1)</span><br><span class="line">    public CasWebflowConfigurer defaultWebflowConfigurer() &#123;</span><br><span class="line">        MyLoginWebflowConfiger c = new MyLoginWebflowConfiger(flowBuilderServices,loginFlowRegistry , this.applicationContext, this.casProperties);</span><br><span class="line">        c.setLogoutFlowDefinitionRegistry(logoutFlowRegistry);</span><br><span class="line">        return c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><strong>接下来是编写配置文件，使用Spring 的SPI机制将 CASWebFlowConfig注入到Spring中，因为我们编写的类并没有在 CAS工程的 Spring 的扫描路径下，所以我们使用 Spring 的 SPI 机制 来配置，在 resources 下新建 META-INF 文件夹,新建文件 spring.factories,配置注册的类全路径，将我们刚才编写的注册类</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=com.sunnada.cas.Config,com.sunnada.cas.CASWebFlowConfig</span><br></pre></td></tr></table></figure>

<h4 id="自定义View"><a href="#自定义View" class="headerlink" title="自定义View"></a>自定义View</h4><p><strong>在定制界面和webflow时候，我们需要将我们重写的资源放到我们自定义的maven resources 对应的目录下(比如我们需要重写webflow/login/login-webflow.xml 那我们就要在我们的 resources 目录下新建webflow/login/login-webflow.xml，然后再修改自己的文件内容)，然后再maven中排除overlays中的文件,详细配置请看注意一节</strong></p>
<p>CAS 是用 Thymeleaf 模板来实现页面渲染的，我们在 login-webflow.xml 中找到 viewLoginForm 标签发现其重定向到 casLoginView 页面,我们在 bind下新增 code 属性 这边绑定的model  credential 已经在我们上面改成了 MyUsernamePasswordCredential 对象，里面有个 code 字段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;view-state id=&quot;viewLoginForm&quot; view=&quot;casLoginView&quot; model=&quot;credential&quot;&gt;</span><br><span class="line">        &lt;binder&gt;</span><br><span class="line">            &lt;binding property=&quot;username&quot; required=&quot;true&quot;/&gt;</span><br><span class="line">            &lt;binding property=&quot;password&quot; required=&quot;true&quot;/&gt;</span><br><span class="line">            &lt;binding property=&quot;code&quot; required=&quot;true&quot;/&gt;</span><br><span class="line">        &lt;/binder&gt;</span><br><span class="line">        &lt;transition on=&quot;submit&quot; bind=&quot;true&quot; validate=&quot;true&quot; to=&quot;realSubmit&quot; history=&quot;invalidate&quot;/&gt;</span><br><span class="line">    &lt;/view-state&gt;</span><br></pre></td></tr></table></figure>

<p>我们在 resources/templates 目录下找到 casLoginView.html,这是一个普通的 Thymeleaf 模板</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html xmlns:layout=&quot;http://www.ultraq.net.nz/thymeleaf/layout&quot; layout:decorate=&quot;~&#123;layout&#125;&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;/&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, shrink-to-fit=no&quot;/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;title th:text=&quot;#&#123;cas.login.pagetitle&#125;&quot;&gt;CAS Acceptable Use Policy View&lt;/title&gt;</span><br><span class="line">    &lt;link href=&quot;../../static/css/cas.css&quot; rel=&quot;stylesheet&quot; th:remove=&quot;tag&quot; /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body class=&quot;login&quot;&gt;</span><br><span class="line">&lt;main role=&quot;main&quot; class=&quot;container mt-3 mb-3&quot;&gt;</span><br><span class="line">    &lt;div layout:fragment=&quot;content&quot; class=&quot;row&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;col-md&quot;&gt;</span><br><span class="line">        &lt;!-- 表单部分代码 --&gt;</span><br><span class="line">            &lt;div th:replace=&quot;fragments/loginform :: loginform&quot;&gt;&lt;a href=&quot;fragments/loginform.html&quot;&gt;Login Form goes</span><br><span class="line">                here&lt;/a&gt;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div id=&quot;notices&quot; class=&quot;col-md mt-3 mt-md-0&quot;&gt;</span><br><span class="line">            &lt;div th:replace=&quot;fragments/insecure :: insecure&quot;&gt;&lt;a href=&quot;fragments/insecure.html&quot;&gt;insecure alert goes</span><br><span class="line">                here&lt;/a&gt;&lt;/div&gt;</span><br><span class="line">            &lt;div th:replace=&quot;fragments/defaultauthn :: staticAuthentication&quot;&gt;</span><br><span class="line">                &lt;a href=&quot;fragments/defaultauthn.html&quot;&gt;defaultAuthn&lt;/a&gt;</span><br><span class="line">                fragment</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div th:replace=&quot;fragments/cookies :: cookiesDisabled&quot;&gt;&lt;a href=&quot;fragments/cookies.html&quot;&gt;cookies&lt;/a&gt; fragment</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div th:replace=&quot;fragments/serviceui :: serviceUI&quot;&gt;&lt;a href=&quot;fragments/serviceui.html&quot;&gt;service ui&lt;/a&gt; fragment&lt;/div&gt;</span><br><span class="line">            &lt;div th:replace=&quot;fragments/loginProviders :: loginProviders&quot;&gt;&lt;a href=&quot;fragments/loginProviders.html&quot;&gt;loginProviders&lt;/a&gt;</span><br><span class="line">                fragment</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div th:replace=&quot;fragments/cas-resources-list :: cas-resource-list&quot;&gt;</span><br><span class="line">                &lt;a href=&quot;fragments/cas-resources-list.html&quot;&gt;cas-resource&lt;/a&gt; list fragment</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/main&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>代码中得知，表单部分在在 fragments/loginform目录下，我们查看那部分代码，并在下面添加一个input框 其name属性为code 用于绑定我们自定义的 MyUsernamePasswordCredential 对象,添加部分已经注释出来</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;/&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, shrink-to-fit=no&quot;/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;title&gt;Login Form Fragment&lt;/title&gt;</span><br><span class="line">    &lt;link href=&quot;../../static/css/cas.css&quot; rel=&quot;stylesheet&quot; th:remove=&quot;tag&quot; /&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;main role=&quot;main&quot; class=&quot;container mt-3 mb-3&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;row&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;col-md&quot;&gt;</span><br><span class="line">            &lt;!-- Login form template begins here --&gt;</span><br><span class="line">            &lt;div th:fragment=&quot;loginform&quot; class=&quot;card&quot;&gt;</span><br><span class="line">                &lt;div class=&quot;card-header text-center&quot;&gt;</span><br><span class="line">                    &lt;h2 th:text=&quot;#&#123;cas.login.pagetitle&#125;&quot;&gt;Login&lt;/h2&gt;</span><br><span class="line">                    &lt;span class=&quot;fa-stack fa-2x hidden-xs&quot;&gt;</span><br><span class="line">                      &lt;i class=&quot;fa fa-circle fa-stack-2x&quot;&gt;&lt;/i&gt;</span><br><span class="line">                      &lt;i class=&quot;fa fa-lock fa-stack-1x fa-inverse&quot;&gt;&lt;/i&gt;</span><br><span class="line">                    &lt;/span&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;card-body&quot;&gt;</span><br><span class="line">                    &lt;form method=&quot;post&quot; id=&quot;fm1&quot; th:object=&quot;$&#123;credential&#125;&quot; action=&quot;login&quot;&gt;</span><br><span class="line">                        &lt;div class=&quot;alert alert-danger&quot; th:if=&quot;$&#123;#fields.hasErrors(&apos;*&apos;)&#125;&quot;&gt;</span><br><span class="line">                            &lt;span th:each=&quot;err : $&#123;#fields.errors(&apos;*&apos;)&#125;&quot; th:utext=&quot;$&#123;err&#125;&quot;&gt;Example error&lt;/span&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">                        &lt;h3 th:utext=&quot;#&#123;screen.welcome.instructions&#125;&quot;&gt;Enter your Username and Password&lt;/h3&gt;</span><br><span class="line"></span><br><span class="line">                        &lt;section class=&quot;form-group&quot;&gt;</span><br><span class="line">                            &lt;label for=&quot;username&quot; th:utext=&quot;#&#123;screen.welcome.label.netid&#125;&quot;&gt;Username&lt;/label&gt;</span><br><span class="line"></span><br><span class="line">                            &lt;div th:if=&quot;$&#123;openIdLocalId&#125;&quot;&gt;</span><br><span class="line">                                &lt;strong&gt;</span><br><span class="line">                                    &lt;span th:utext=&quot;$&#123;openIdLocalId&#125;&quot;/&gt;</span><br><span class="line">                                &lt;/strong&gt;</span><br><span class="line">                                &lt;input type=&quot;hidden&quot;</span><br><span class="line">                                       id=&quot;username&quot;</span><br><span class="line">                                       name=&quot;username&quot;</span><br><span class="line">                                       th:value=&quot;$&#123;openIdLocalId&#125;&quot;/&gt;</span><br><span class="line">                            &lt;/div&gt;</span><br><span class="line">                            &lt;div th:unless=&quot;$&#123;openIdLocalId&#125;&quot;&gt;</span><br><span class="line">                                &lt;input class=&quot;form-control required&quot;</span><br><span class="line">                                       id=&quot;username&quot;</span><br><span class="line">                                       size=&quot;25&quot;</span><br><span class="line">                                       tabindex=&quot;1&quot;</span><br><span class="line">                                       type=&quot;text&quot;</span><br><span class="line">                                       th:disabled=&quot;$&#123;guaEnabled&#125;&quot;</span><br><span class="line">                                       th:field=&quot;*&#123;username&#125;&quot;</span><br><span class="line">                                       th:accesskey=&quot;#&#123;screen.welcome.label.netid.accesskey&#125;&quot;</span><br><span class="line">                                       autocomplete=&quot;off&quot;/&gt;</span><br><span class="line">                            &lt;/div&gt;</span><br><span class="line">                        &lt;/section&gt;</span><br><span class="line"></span><br><span class="line">                        &lt;section class=&quot;form-group&quot;&gt;</span><br><span class="line">                            &lt;label for=&quot;password&quot; th:utext=&quot;#&#123;screen.welcome.label.password&#125;&quot;&gt;Password&lt;/label&gt;</span><br><span class="line"></span><br><span class="line">                            &lt;div&gt;</span><br><span class="line">                                &lt;input class=&quot;form-control required&quot;</span><br><span class="line">                                       type=&quot;password&quot;</span><br><span class="line">                                       id=&quot;password&quot;</span><br><span class="line">                                       size=&quot;25&quot;</span><br><span class="line">                                       tabindex=&quot;2&quot;</span><br><span class="line">                                       th:accesskey=&quot;#&#123;screen.welcome.label.password.accesskey&#125;&quot;</span><br><span class="line">                                       th:field=&quot;*&#123;password&#125;&quot;</span><br><span class="line">                                       autocomplete=&quot;off&quot;/&gt;</span><br><span class="line">                                &lt;span id=&quot;capslock-on&quot; style=&quot;display:none;&quot;&gt;</span><br><span class="line">                                &lt;p&gt;</span><br><span class="line">                                    &lt;i class=&quot;fa fa-exclamation-circle&quot;&gt;&lt;/i&gt;</span><br><span class="line">                                    &lt;span th:utext=&quot;#&#123;screen.capslock.on&#125;&quot;/&gt;</span><br><span class="line">                                &lt;/p&gt;</span><br><span class="line">                            &lt;/span&gt;</span><br><span class="line">                            &lt;/div&gt;</span><br><span class="line">                        &lt;/section&gt;</span><br><span class="line"></span><br><span class="line">                        &lt;!-- 新增code 表单代码  --&gt;</span><br><span class="line"></span><br><span class="line">                        &lt;section class=&quot;form-group&quot;&gt;</span><br><span class="line">                            &lt;label for=&quot;code&quot;&gt;code...&lt;/label&gt;</span><br><span class="line"></span><br><span class="line">                            &lt;div&gt;</span><br><span class="line">                                &lt;input class=&quot;form-control required&quot;</span><br><span class="line">                                       type=&quot;text&quot;</span><br><span class="line">                                       id=&quot;code&quot;</span><br><span class="line">                                       size=&quot;25&quot;</span><br><span class="line">                                       name=&quot;code&quot;</span><br><span class="line">                                       tabindex=&quot;2&quot;</span><br><span class="line">                                       th:accesskey=&quot;#&#123;screen.welcome.label.password.accesskey&#125;&quot;</span><br><span class="line">                                       autocomplete=&quot;off&quot;/&gt;</span><br><span class="line">                                &lt;span id=&quot;capslock-on&quot; style=&quot;display:none;&quot;&gt;</span><br><span class="line">                                &lt;p&gt;</span><br><span class="line">                                    &lt;i class=&quot;fa fa-exclamation-circle&quot;&gt;&lt;/i&gt;</span><br><span class="line">                                    &lt;span th:utext=&quot;#&#123;screen.capslock.on&#125;&quot;/&gt;</span><br><span class="line">                                &lt;/p&gt;</span><br><span class="line">                            &lt;/span&gt;</span><br><span class="line">                            &lt;/div&gt;</span><br><span class="line">                        &lt;/section&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                        &lt;section class=&quot;form-check&quot; th:if=&quot;$&#123;passwordManagementEnabled &amp;&amp; param.doChangePassword != null&#125;&quot;&gt;</span><br><span class="line">                            &lt;p&gt;</span><br><span class="line">                                &lt;input type=&quot;checkbox&quot; name=&quot;doChangePassword&quot; id=&quot;doChangePassword&quot;</span><br><span class="line">                                       value=&quot;true&quot; th:checked=&quot;$&#123;param.doChangePassword != null&#125;&quot; tabindex=&quot;4&quot;/&gt;</span><br><span class="line">                                &lt;label for=&quot;doChangePassword&quot; th:text=&quot;#&#123;screen.button.changePassword&#125;&quot;&gt;Change Password&lt;/label&gt;</span><br><span class="line">                            &lt;/p&gt;</span><br><span class="line">                        &lt;/section&gt;</span><br><span class="line"></span><br><span class="line">                        &lt;section class=&quot;form-check&quot; th:if=&quot;$&#123;rememberMeAuthenticationEnabled&#125;&quot;&gt;</span><br><span class="line">                            &lt;p&gt;</span><br><span class="line">                                &lt;input type=&quot;checkbox&quot; name=&quot;rememberMe&quot; id=&quot;rememberMe&quot; value=&quot;true&quot; tabindex=&quot;5&quot;/&gt;</span><br><span class="line">                                &lt;label for=&quot;rememberMe&quot; th:text=&quot;#&#123;screen.rememberme.checkbox.title&#125;&quot;&gt;Remember Me&lt;/label&gt;</span><br><span class="line">                            &lt;/p&gt;</span><br><span class="line">                        &lt;/section&gt;</span><br><span class="line"></span><br><span class="line">                        &lt;section class=&quot;row&quot; th:if=&quot;$&#123;recaptchaSiteKey != null AND recaptchaInvisible != null AND recaptchaSiteKey AND !recaptchaInvisible&#125;&quot;&gt;</span><br><span class="line">                            &lt;div class=&quot;g-recaptcha&quot; th:attr=&quot;data-sitekey=$&#123;recaptchaSiteKey&#125;&quot;/&gt;</span><br><span class="line">                        &lt;/section&gt;</span><br><span class="line"></span><br><span class="line">                        &lt;input type=&quot;hidden&quot; name=&quot;execution&quot; th:value=&quot;$&#123;flowExecutionKey&#125;&quot;/&gt;</span><br><span class="line">                        &lt;input type=&quot;hidden&quot; name=&quot;_eventId&quot; value=&quot;submit&quot;/&gt;</span><br><span class="line">                        &lt;input type=&quot;hidden&quot; name=&quot;geolocation&quot;/&gt;</span><br><span class="line">                        &lt;input class=&quot;btn btn-block btn-submit&quot;</span><br><span class="line">                               th:unless=&quot;$&#123;recaptchaSiteKey != null AND recaptchaInvisible != null AND recaptchaSiteKey AND recaptchaInvisible&#125;&quot;</span><br><span class="line">                               name=&quot;submit&quot;</span><br><span class="line">                               accesskey=&quot;l&quot;</span><br><span class="line">                               th:value=&quot;#&#123;screen.welcome.button.login&#125;&quot;</span><br><span class="line">                               tabindex=&quot;6&quot;</span><br><span class="line">                               type=&quot;submit&quot;</span><br><span class="line">                               value=&quot;Login3&quot;</span><br><span class="line">                        /&gt;</span><br><span class="line">                        &lt;button class=&quot;btn btn-block btn-submit g-recaptcha&quot;</span><br><span class="line">                                th:if=&quot;$&#123;recaptchaSiteKey != null AND recaptchaInvisible != null AND recaptchaSiteKey AND recaptchaInvisible&#125;&quot;</span><br><span class="line">                                th:attr=&quot;data-sitekey=$&#123;recaptchaSiteKey&#125;, data-badge=$&#123;recaptchaPosition&#125;&quot;</span><br><span class="line">                                data-callback=&quot;onSubmit&quot;</span><br><span class="line">                                name=&quot;submitBtn&quot;</span><br><span class="line">                                accesskey=&quot;l&quot;</span><br><span class="line">                                th:text=&quot;#&#123;screen.welcome.button.login&#125;&quot;</span><br><span class="line">                                tabindex=&quot;6&quot;</span><br><span class="line">                        /&gt;</span><br><span class="line">                    &lt;/form&gt;</span><br><span class="line"></span><br><span class="line">                    &lt;form th:if=&quot;$&#123;passwordManagementEnabled&#125;&quot; method=&quot;post&quot; id=&quot;passwordManagementForm&quot;&gt;</span><br><span class="line">                        &lt;input type=&quot;hidden&quot; name=&quot;execution&quot; th:value=&quot;$&#123;flowExecutionKey&#125;&quot;/&gt;</span><br><span class="line">                        &lt;input type=&quot;hidden&quot; name=&quot;_eventId&quot; value=&quot;resetPassword&quot;/&gt;</span><br><span class="line">                        &lt;span class=&quot;fa fa-unlock&quot;&gt;&lt;/span&gt;</span><br><span class="line">                        &lt;a th:utext=&quot;#&#123;screen.pm.button.resetPassword&#125;&quot; href=&quot;javascript:void(0)&quot; onclick=&quot;$(&apos;#passwordManagementForm&apos;).submit();&quot;/&gt;</span><br><span class="line">                        &lt;p/&gt;</span><br><span class="line">                    &lt;/form&gt;</span><br><span class="line"></span><br><span class="line">                    &lt;div th:unless=&quot;$&#123;passwordManagementEnabled&#125;&quot;&gt;</span><br><span class="line">                        &lt;span class=&quot;fa fa-question-circle&quot;&gt;&lt;/span&gt;</span><br><span class="line">                        &lt;span th:utext=&quot;#&#123;screen.pm.button.forgotpwd&#125;&quot;&gt;Forgot your password?&lt;/span&gt;</span><br><span class="line">                        &lt;p/&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">                    &lt;script type=&quot;text/javascript&quot; th:inline=&quot;javascript&quot;&gt;</span><br><span class="line">                        var i = [[#&#123;screen.welcome.button.loginwip&#125;]]</span><br><span class="line">                        $( document ).ready(function() &#123;</span><br><span class="line">                            $(&quot;#fm1&quot;).submit(function () &#123;</span><br><span class="line">                                $(&quot;:submit&quot;).attr(&quot;disabled&quot;, true);</span><br><span class="line">                                $(&quot;:submit&quot;).attr(&quot;value&quot;, i);</span><br><span class="line">                                console.log(i);</span><br><span class="line">                                return true;</span><br><span class="line">                            &#125;);</span><br><span class="line">                        &#125;);</span><br><span class="line">                    &lt;/script&gt;</span><br><span class="line"></span><br><span class="line">                    &lt;div th:replace=&quot;fragments/loginsidebar :: loginsidebar&quot; /&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/main&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p><strong>现在我们运行CAS Service 进入登录页已经可以看见页面增加了一个code 字段，我们也完成了M和V的绑定，前端的表单对象会绑定我们后端配置的MyUsernamePasswordCredential 对象,后续我们要做的就是完成自定义认证</strong></p>
<h4 id="自定义认证"><a href="#自定义认证" class="headerlink" title="自定义认证"></a>自定义认证</h4><p>以上部分我们只是完成了 M 和 V的绑定，现在我们实现自定义认证，这边我采用 mybatis 来当做持久层来从数据库中查询数据</p>
<h5 id="mybtais配置"><a href="#mybtais配置" class="headerlink" title="mybtais配置"></a>mybtais配置</h5><p><strong>由于刚开始实践时我直接继承 mybatis-stater 来完成mybatis，但是发现无论怎么尝试，CAS 都无法完成对 Mybtais-stater中的配置文件完成自动配置，于是我采用手动配置的方法完成mybatis的集成</strong>  </p>
<ul>
<li><p>POM文件配置<br>加上 mybatis-spring 和 mybatis的包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.mybatis&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis-spring&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.0.3&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.mybatis&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;3.4.6&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置mybatis数据源<br>mybatis 的核心是SqlSessionFactory 类而其有依赖DataSource 类所以我们进行如下配置即可，如果需要使用连接池，修改DataSource中的配置即可，现在我们就可以正常使用 mybatis 的功能了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">public class DataSourceConfig &#123;</span><br><span class="line"></span><br><span class="line">    //配置数据源</span><br><span class="line">    @Bean</span><br><span class="line">    public DataSource dataSource()&#123;</span><br><span class="line"></span><br><span class="line">        DriverManagerDataSource dataSource= new DriverManagerDataSource(&quot;jdbc:mysql://192.168.169.94:3306/mysql?serverTimezone=CTT&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;allowMultiQueries=true&amp;useSSL=false&quot;,&quot;root&quot;,&quot;root&quot;);</span><br><span class="line">        dataSource.setDriverClassName(&quot;com.mysql.cj.jdbc.Driver&quot;);</span><br><span class="line">        return dataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   //配置 mybatis自动扫描 Mapper</span><br><span class="line">    @Bean</span><br><span class="line">    public MapperScannerConfigurer mapperScannerConfigurer()&#123;</span><br><span class="line">        MapperScannerConfigurer mapperScannerConfigurer=new MapperScannerConfigurer();</span><br><span class="line">        mapperScannerConfigurer.setSqlSessionFactoryBeanName(&quot;sqlSessionFactory&quot;);</span><br><span class="line">        mapperScannerConfigurer.setBasePackage(&quot;com.sunnada&quot;);</span><br><span class="line">        return mapperScannerConfigurer;</span><br><span class="line">    &#125;</span><br><span class="line">    @Bean</span><br><span class="line">    public SqlSessionFactory sqlSessionFactory() throws Exception &#123;</span><br><span class="line">        SqlSessionFactoryBean factoryBean = new SqlSessionFactoryBean();</span><br><span class="line">        factoryBean.setMapperLocations();</span><br><span class="line">        factoryBean.setDataSource(dataSource());</span><br><span class="line">        ResourcePatternResolver resourcePatternResolver=new PathMatchingResourcePatternResolver();</span><br><span class="line">        //配置扫描对应路径的xml</span><br><span class="line">        resourcePatternResolver.getResources(&quot;classpath*:mapper/*.xml&quot;);</span><br><span class="line">        factoryBean.setMapperLocations(resourcePatternResolver.getResources(&quot;classpath*:mapper/*.xml&quot;));</span><br><span class="line">        return factoryBean.getObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>自定义 CAS 认证<br>CAS 认证扩展类为 AuthenticationHandler 我们实现其抽象类 AbstractPreAndPostProcessingAuthenticationHandler即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">public class CustomUsernamePasswordAuthentication extends AbstractPreAndPostProcessingAuthenticationHandler &#123;</span><br><span class="line"></span><br><span class="line">    private UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    //UserMapper 为mybatis的 mapper 接口，在构造方法中手动赋值  </span><br><span class="line">    public CustomUsernamePasswordAuthentication(String name, ServicesManager servicesManager, PrincipalFactory principalFactory, Integer order,UserMapper userMapper) &#123;</span><br><span class="line">        super(name, servicesManager, principalFactory, order);</span><br><span class="line">        this.userMapper=userMapper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //设置只支持验证 MyUsernamePasswordCredential 类型的 Credential</span><br><span class="line">    @Override</span><br><span class="line">    public boolean supports(Credential credential)&#123;</span><br><span class="line"></span><br><span class="line">        return credential instanceof MyUsernamePasswordCredential ;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected AuthenticationHandlerExecutionResult doAuthentication(Credential credential) throws GeneralSecurityException, PreventedException &#123;</span><br><span class="line"></span><br><span class="line">        MyUsernamePasswordCredential myUsernamePasswordCredential=(MyUsernamePasswordCredential)credential;</span><br><span class="line"></span><br><span class="line">        //如果从数据库中根据用户和密码查出的用户id不为空则用户存在</span><br><span class="line"></span><br><span class="line">        String userId=userMapper.findUserName(myUsernamePasswordCredential.getUsername()</span><br><span class="line">                ,myUsernamePasswordCredential.getPassword());</span><br><span class="line"></span><br><span class="line">        //验证code时候正确</span><br><span class="line">        if(userId!= null</span><br><span class="line">                    &amp;&amp; &quot;code&quot;.equals(((MyUsernamePasswordCredential) credential).getCode())</span><br><span class="line"></span><br><span class="line">                )&#123;</span><br><span class="line">            List&lt;MessageDescriptor&gt; list = new ArrayList&lt;&gt;();</span><br><span class="line">            return createHandlerResult(credential,this.principalFactory.createPrincipal(credential.getId()),list);</span><br><span class="line">        &#125;</span><br><span class="line">        //登录失败抛出异常</span><br><span class="line">        throw new FailedLoginException(&quot;登录失败 &quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在CAS 中注册 AuthenticationHandler</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">public class Config implements AuthenticationEventExecutionPlanConfigurer &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    @Qualifier(&quot;servicesManager&quot;)</span><br><span class="line">    private ServicesManager servicesManager;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    //AuthenticationHandler依赖 &quot;dataSource&quot;,&quot;mapperScannerConfigurer&quot;,&quot;sqlSessionFactory&quot; 这三个bean</span><br><span class="line">    @Bean</span><br><span class="line">    @DependsOn(&#123;&quot;dataSource&quot;,&quot;mapperScannerConfigurer&quot;,&quot;sqlSessionFactory&quot;&#125;)</span><br><span class="line">    public AuthenticationHandler authenticationHandler()&#123;</span><br><span class="line"></span><br><span class="line">        return new CustomUsernamePasswordAuthentication(CustomUsernamePasswordAuthentication.class.getName(), servicesManager, new DefaultPrincipalFactory(), 1,userMapper);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void configureAuthenticationExecutionPlan(AuthenticationEventExecutionPlan plan) &#123;</span><br><span class="line">        plan.registerAuthenticationHandler(authenticationHandler());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 spring.factories 文件 中注册你需要在Spring中的配置类</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=com.sunnada.cas.DataSourceConfig,\</span><br><span class="line">com.sunnada.cas.Config,com.sunnada.cas.CASWebFlowConfig</span><br></pre></td></tr></table></figure>

<p>到此为止自定义登录就已经完成</p>
<h4 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h4><h5 id="我们在基于CAS-overlay做扩展的时候，有一些jar包已经集成在war中，但是我们编写扩展类的时候也需要这部分代码，我们可以将这部分pox文件引入并设置作用域为provided-特别注意在设置-maven-war-plugin-插件时需要将-overlays中重复的配置文件排除出去"><a href="#我们在基于CAS-overlay做扩展的时候，有一些jar包已经集成在war中，但是我们编写扩展类的时候也需要这部分代码，我们可以将这部分pox文件引入并设置作用域为provided-特别注意在设置-maven-war-plugin-插件时需要将-overlays中重复的配置文件排除出去" class="headerlink" title="我们在基于CAS overlay做扩展的时候，有一些jar包已经集成在war中，但是我们编写扩展类的时候也需要这部分代码，我们可以将这部分pox文件引入并设置作用域为provided,特别注意在设置 maven-war-plugin 插件时需要将 overlays中重复的配置文件排除出去"></a>我们在基于CAS overlay做扩展的时候，有一些jar包已经集成在war中，但是我们编写扩展类的时候也需要这部分代码，我们可以将这部分pox文件引入并设置作用域为provided,<strong>特别注意在设置 maven-war-plugin 插件时需要将 overlays中重复的配置文件排除出去</strong></h5><p>如本人依赖如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd &quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line">    &lt;groupId&gt;org.apereo.cas&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;cas-overlay&lt;/artifactId&gt;</span><br><span class="line">    &lt;packaging&gt;war&lt;/packaging&gt;</span><br><span class="line">    &lt;version&gt;1.0&lt;/version&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apereo.cas&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;cas-server-webapp$&#123;app.server&#125;&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;cas.version&#125;&lt;/version&gt;</span><br><span class="line">            &lt;type&gt;war&lt;/type&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--json服务注册--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apereo.cas&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;cas-server-support-json-service-registry&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;cas.version&#125;&lt;/version&gt;</span><br><span class="line">            &lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apereo.cas&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;cas-server-core-authentication&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;cas.version&#125;&lt;/version&gt;</span><br><span class="line">            &lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apereo.cas&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;cas-server-core-authentication-api&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;cas.version&#125;&lt;/version&gt;</span><br><span class="line">            &lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;8.0.16&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.mybatis&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis-spring&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.0.3&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- https://mvnrepository.com/artifact/org.mybatis/mybatis --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.mybatis&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;3.4.6&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter --&gt;</span><br><span class="line">        &lt;!--引入Spring SPI机制 --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.5.2.RELEASE&lt;/version&gt;</span><br><span class="line">            &lt;exclusions&gt;</span><br><span class="line">                &lt;exclusion&gt;</span><br><span class="line">                    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">                    &lt;artifactId&gt;spring-boot-starter-logging&lt;/artifactId&gt;</span><br><span class="line">                &lt;/exclusion&gt;</span><br><span class="line">            &lt;/exclusions&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apereo.cas&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;cas-server-core-configuration&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;cas.version&#125;&lt;/version&gt;</span><br><span class="line">            &lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apereo.cas&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;cas-server-support-rest&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;cas.version&#125;&lt;/version&gt;</span><br><span class="line">            &lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apereo.cas&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;cas-server-core-webflow-api&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;cas.version&#125;&lt;/version&gt;</span><br><span class="line">            &lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apereo.cas&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;cas-server-core-webflow&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;cas.version&#125;&lt;/version&gt;</span><br><span class="line">            &lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- https://mvnrepository.com/artifact/org.apereo.cas/cas-server-support-actions --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apereo.cas&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;cas-server-support-actions&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;cas.version&#125;&lt;/version&gt;</span><br><span class="line">            &lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.12.6&lt;/version&gt;</span><br><span class="line">            &lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;com.rimerosolutions.maven.plugins&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;wrapper-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;0.0.5&lt;/version&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;verifyDownload&gt;true&lt;/verifyDownload&gt;</span><br><span class="line">                    &lt;checksumAlgorithm&gt;MD5&lt;/checksumAlgorithm&gt;</span><br><span class="line">                &lt;/configuration&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;$&#123;springboot.version&#125;&lt;/version&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;mainClass&gt;$&#123;mainClassName&#125;&lt;/mainClass&gt;</span><br><span class="line">                    &lt;addResources&gt;true&lt;/addResources&gt;</span><br><span class="line">                    &lt;executable&gt;$&#123;isExecutable&#125;&lt;/executable&gt;</span><br><span class="line">                    &lt;layout&gt;WAR&lt;/layout&gt;</span><br><span class="line">                &lt;/configuration&gt;</span><br><span class="line">                &lt;executions&gt;</span><br><span class="line">                    &lt;execution&gt;</span><br><span class="line">                        &lt;goals&gt;</span><br><span class="line">                            &lt;goal&gt;repackage&lt;/goal&gt;</span><br><span class="line">                        &lt;/goals&gt;</span><br><span class="line">                    &lt;/execution&gt;</span><br><span class="line">                &lt;/executions&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;2.6&lt;/version&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;warName&gt;cas&lt;/warName&gt;</span><br><span class="line">                    &lt;failOnMissingWebXml&gt;false&lt;/failOnMissingWebXml&gt;</span><br><span class="line">                    &lt;recompressZippedFiles&gt;false&lt;/recompressZippedFiles&gt;</span><br><span class="line">                    &lt;archive&gt;</span><br><span class="line">                        &lt;compress&gt;false&lt;/compress&gt;</span><br><span class="line">                        &lt;manifestFile&gt;$&#123;manifestFileToUse&#125;&lt;/manifestFile&gt;</span><br><span class="line">                    &lt;/archive&gt;</span><br><span class="line">                    &lt;overlays&gt;</span><br><span class="line">                        &lt;overlay&gt;</span><br><span class="line">                            &lt;groupId&gt;org.apereo.cas&lt;/groupId&gt;</span><br><span class="line">                            &lt;artifactId&gt;cas-server-webapp$&#123;app.server&#125;&lt;/artifactId&gt;</span><br><span class="line">                            &lt;!--原有的服务不再初始化进去--&gt;</span><br><span class="line">                            &lt;excludes&gt;</span><br><span class="line">                                &lt;exclude&gt;WEB-INF/classes/services/*&lt;/exclude&gt;</span><br><span class="line">                                &lt;exclude&gt;WEB-INF/classes/application.*&lt;/exclude&gt;</span><br><span class="line">                                &lt;exclude&gt;WEB-INF/classes/log4j2.*&lt;/exclude&gt;</span><br><span class="line">                            &lt;/excludes&gt;</span><br><span class="line">                        &lt;/overlay&gt;</span><br><span class="line">                    &lt;/overlays&gt;</span><br><span class="line">                &lt;/configuration&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;3.3&lt;/version&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">        &lt;/plugins&gt;</span><br><span class="line">        &lt;finalName&gt;cas&lt;/finalName&gt;</span><br><span class="line">    &lt;/build&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;cas.version&gt;5.3.1&lt;/cas.version&gt;</span><br><span class="line">        &lt;springboot.version&gt;1.5.18.RELEASE&lt;/springboot.version&gt;</span><br><span class="line">        &lt;!-- app.server could be -jetty, -undertow, -tomcat, or blank if you plan to provide appserver --&gt;</span><br><span class="line">        &lt;app.server&gt;-tomcat&lt;/app.server&gt;</span><br><span class="line"></span><br><span class="line">        &lt;mainClassName&gt;org.springframework.boot.loader.WarLauncher&lt;/mainClassName&gt;</span><br><span class="line">        &lt;isExecutable&gt;false&lt;/isExecutable&gt;</span><br><span class="line">        &lt;manifestFileToUse&gt;$&#123;project.build.directory&#125;/war/work/org.apereo.cas/cas-server-webapp$&#123;app.server&#125;/META-INF/MANIFEST.MF&lt;/manifestFileToUse&gt;</span><br><span class="line"></span><br><span class="line">        &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;</span><br><span class="line">        &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;</span><br><span class="line">        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;repositories&gt;</span><br><span class="line">        &lt;repository&gt;</span><br><span class="line">            &lt;id&gt;sonatype-releases&lt;/id&gt;</span><br><span class="line">            &lt;url&gt;http://oss.sonatype.org/content/repositories/releases/&lt;/url&gt;</span><br><span class="line">            &lt;snapshots&gt;</span><br><span class="line">                &lt;enabled&gt;false&lt;/enabled&gt;</span><br><span class="line">            &lt;/snapshots&gt;</span><br><span class="line">            &lt;releases&gt;</span><br><span class="line">                &lt;enabled&gt;true&lt;/enabled&gt;</span><br><span class="line">            &lt;/releases&gt;</span><br><span class="line">        &lt;/repository&gt;</span><br><span class="line">        &lt;repository&gt;</span><br><span class="line">            &lt;id&gt;sonatype-snapshots&lt;/id&gt;</span><br><span class="line">            &lt;url&gt;https://oss.sonatype.org/content/repositories/snapshots/&lt;/url&gt;</span><br><span class="line">            &lt;snapshots&gt;</span><br><span class="line">                &lt;enabled&gt;true&lt;/enabled&gt;</span><br><span class="line">            &lt;/snapshots&gt;</span><br><span class="line">            &lt;releases&gt;</span><br><span class="line">                &lt;enabled&gt;false&lt;/enabled&gt;</span><br><span class="line">            &lt;/releases&gt;</span><br><span class="line">        &lt;/repository&gt;</span><br><span class="line">        &lt;repository&gt;</span><br><span class="line">            &lt;id&gt;shibboleth-releases&lt;/id&gt;</span><br><span class="line">            &lt;url&gt;https://build.shibboleth.net/nexus/content/repositories/releases&lt;/url&gt;</span><br><span class="line">        &lt;/repository&gt;</span><br><span class="line">    &lt;/repositories&gt;</span><br><span class="line"></span><br><span class="line">    &lt;profiles&gt;</span><br><span class="line">        &lt;profile&gt;</span><br><span class="line">            &lt;activation&gt;</span><br><span class="line">                &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;</span><br><span class="line">            &lt;/activation&gt;</span><br><span class="line">            &lt;id&gt;default&lt;/id&gt;</span><br><span class="line">            &lt;dependencies&gt;</span><br><span class="line">                &lt;dependency&gt;</span><br><span class="line">                    &lt;groupId&gt;org.apereo.cas&lt;/groupId&gt;</span><br><span class="line">                    &lt;artifactId&gt;cas-server-webapp$&#123;app.server&#125;&lt;/artifactId&gt;</span><br><span class="line">                    &lt;version&gt;$&#123;cas.version&#125;&lt;/version&gt;</span><br><span class="line">                    &lt;type&gt;war&lt;/type&gt;</span><br><span class="line">                    &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">                &lt;/dependency&gt;</span><br><span class="line">                &lt;!--</span><br><span class="line">                ...Additional dependencies may be placed here...</span><br><span class="line">                --&gt;</span><br><span class="line">            &lt;/dependencies&gt;</span><br><span class="line">        &lt;/profile&gt;</span><br><span class="line"></span><br><span class="line">        &lt;profile&gt;</span><br><span class="line">            &lt;activation&gt;</span><br><span class="line">                &lt;activeByDefault&gt;false&lt;/activeByDefault&gt;</span><br><span class="line">            &lt;/activation&gt;</span><br><span class="line">            &lt;id&gt;exec&lt;/id&gt;</span><br><span class="line">            &lt;properties&gt;</span><br><span class="line">                &lt;mainClassName&gt;org.apereo.cas.web.CasWebApplication&lt;/mainClassName&gt;</span><br><span class="line">                &lt;isExecutable&gt;true&lt;/isExecutable&gt;</span><br><span class="line">                &lt;manifestFileToUse&gt;&lt;/manifestFileToUse&gt;</span><br><span class="line">            &lt;/properties&gt;</span><br><span class="line">            &lt;build&gt;</span><br><span class="line">                &lt;plugins&gt;</span><br><span class="line">                    &lt;plugin&gt;</span><br><span class="line">                        &lt;groupId&gt;com.soebes.maven.plugins&lt;/groupId&gt;</span><br><span class="line">                        &lt;artifactId&gt;echo-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">                        &lt;version&gt;0.3.0&lt;/version&gt;</span><br><span class="line">                        &lt;executions&gt;</span><br><span class="line">                            &lt;execution&gt;</span><br><span class="line">                                &lt;phase&gt;prepare-package&lt;/phase&gt;</span><br><span class="line">                                &lt;goals&gt;</span><br><span class="line">                                    &lt;goal&gt;echo&lt;/goal&gt;</span><br><span class="line">                                &lt;/goals&gt;</span><br><span class="line">                            &lt;/execution&gt;</span><br><span class="line">                        &lt;/executions&gt;</span><br><span class="line">                        &lt;configuration&gt;</span><br><span class="line">                            &lt;echos&gt;</span><br><span class="line">                                &lt;echo&gt;Executable profile to make the generated CAS web application executable.&lt;/echo&gt;</span><br><span class="line">                            &lt;/echos&gt;</span><br><span class="line">                        &lt;/configuration&gt;</span><br><span class="line">                    &lt;/plugin&gt;</span><br><span class="line">                &lt;/plugins&gt;</span><br><span class="line">            &lt;/build&gt;</span><br><span class="line">        &lt;/profile&gt;</span><br><span class="line"></span><br><span class="line">        &lt;profile&gt;</span><br><span class="line">            &lt;activation&gt;</span><br><span class="line">                &lt;activeByDefault&gt;false&lt;/activeByDefault&gt;</span><br><span class="line">            &lt;/activation&gt;</span><br><span class="line">            &lt;id&gt;bootiful&lt;/id&gt;</span><br><span class="line">            &lt;properties&gt;</span><br><span class="line">                &lt;app.server&gt;-tomcat&lt;/app.server&gt;</span><br><span class="line">                &lt;isExecutable&gt;false&lt;/isExecutable&gt;</span><br><span class="line">            &lt;/properties&gt;</span><br><span class="line">            &lt;dependencies&gt;</span><br><span class="line">                &lt;dependency&gt;</span><br><span class="line">                    &lt;groupId&gt;org.apereo.cas&lt;/groupId&gt;</span><br><span class="line">                    &lt;artifactId&gt;cas-server-webapp$&#123;app.server&#125;&lt;/artifactId&gt;</span><br><span class="line">                    &lt;version&gt;$&#123;cas.version&#125;&lt;/version&gt;</span><br><span class="line">                    &lt;type&gt;war&lt;/type&gt;</span><br><span class="line">                    &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">                &lt;/dependency&gt;</span><br><span class="line">            &lt;/dependencies&gt;</span><br><span class="line">        &lt;/profile&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/profiles&gt;</span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>

<h5 id="排除依赖"><a href="#排除依赖" class="headerlink" title="排除依赖"></a>排除依赖</h5><p>在定制界面和webflow时候，我们需要将我们重写的资源放到我们自定义的maven resources 对应的目录下(比如我们需要重写webflow/login/login-webflow.xml 那我们就要在我们的 resources 目录下新建webflow/login/login-webflow.xml，然后再修改自己的文件内容)，然后再maven中排除overlays中的文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;2.6&lt;/version&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;warName&gt;cas&lt;/warName&gt;</span><br><span class="line">                    &lt;failOnMissingWebXml&gt;false&lt;/failOnMissingWebXml&gt;</span><br><span class="line">                    &lt;recompressZippedFiles&gt;false&lt;/recompressZippedFiles&gt;</span><br><span class="line">                    &lt;archive&gt;</span><br><span class="line">                        &lt;compress&gt;false&lt;/compress&gt;</span><br><span class="line">                        &lt;manifestFile&gt;$&#123;manifestFileToUse&#125;&lt;/manifestFile&gt;</span><br><span class="line">                    &lt;/archive&gt;</span><br><span class="line">                    &lt;overlays&gt;</span><br><span class="line">                        &lt;overlay&gt;</span><br><span class="line">                            &lt;groupId&gt;org.apereo.cas&lt;/groupId&gt;</span><br><span class="line">                            &lt;artifactId&gt;cas-server-webapp$&#123;app.server&#125;&lt;/artifactId&gt;</span><br><span class="line">                            &lt;!--原有的服务不再初始化进去--&gt;</span><br><span class="line">                            &lt;excludes&gt;</span><br><span class="line">                                &lt;exclude&gt;WEB-INF/classes/services/*&lt;/exclude&gt;</span><br><span class="line">                                &lt;exclude&gt;WEB-INF/classes/application.*&lt;/exclude&gt;</span><br><span class="line">                                &lt;exclude&gt;WEB-INF/classes/log4j2.*&lt;/exclude&gt;</span><br><span class="line">                                &lt;exclude&gt;WEB-INF/classes/webflow/login/*.xml&lt;/exclude&gt;</span><br><span class="line">                                &lt;exclude&gt;WEB-INF/classes/templates/fragments/loginform.html&lt;/exclude&gt;</span><br><span class="line"></span><br><span class="line">                            &lt;/excludes&gt;</span><br><span class="line">                        &lt;/overlay&gt;</span><br><span class="line">                    &lt;/overlays&gt;</span><br><span class="line">                &lt;/configuration&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br></pre></td></tr></table></figure>


    </div>

    
    
    
        
      
        <div id="reward-container">
  <div></div>
  <button id="reward-button" disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
        
      
      <div style="display: inline-block">
        <img src="/images/赞赏码.png" alt="刘绍煌 微信支付">
        <p>微信支付</p>
      </div>

  </div>
</div>

      

      <footer class="post-footer">
          
            
          
          <div class="post-tags">
            
              <a href="/tags/CAS/" rel="tag"># CAS</a>
            
          </div>
        

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/2020/01/17/Spring-Web-flow-概念简介/" rel="next" title="Spring Web flow 概念简介">
                  <i class="fa fa-chevron-left"></i> Spring Web flow 概念简介
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/2020/01/21/CAS教程1-CAS的搭建/" rel="prev" title="CAS教程1--CAS的搭建">
                  CAS教程1--CAS的搭建 <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        
      </footer>
    
  </div>
  
  
  
  </article>

  </div>


          </div>
          

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">
        
        
        
        
      

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#简介"><span class="nav-number">1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#前置学习条件"><span class="nav-number">2.</span> <span class="nav-text">前置学习条件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#找到入口Flow-入口"><span class="nav-number">3.</span> <span class="nav-text">找到入口Flow 入口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CAS-M和V的绑定"><span class="nav-number">4.</span> <span class="nav-text">CAS M和V的绑定</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#自定义-CAS-M和V的绑定"><span class="nav-number">5.</span> <span class="nav-text">自定义 CAS M和V的绑定</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#自定义View"><span class="nav-number">6.</span> <span class="nav-text">自定义View</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#自定义认证"><span class="nav-number">7.</span> <span class="nav-text">自定义认证</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#mybtais配置"><span class="nav-number">7.1.</span> <span class="nav-text">mybtais配置</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#注意点"><span class="nav-number">8.</span> <span class="nav-text">注意点</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#我们在基于CAS-overlay做扩展的时候，有一些jar包已经集成在war中，但是我们编写扩展类的时候也需要这部分代码，我们可以将这部分pox文件引入并设置作用域为provided-特别注意在设置-maven-war-plugin-插件时需要将-overlays中重复的配置文件排除出去"><span class="nav-number">8.1.</span> <span class="nav-text">我们在基于CAS overlay做扩展的时候，有一些jar包已经集成在war中，但是我们编写扩展类的时候也需要这部分代码，我们可以将这部分pox文件引入并设置作用域为provided,特别注意在设置 maven-war-plugin 插件时需要将 overlays中重复的配置文件排除出去</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#排除依赖"><span class="nav-number">8.2.</span> <span class="nav-text">排除依赖</span></a></li></ol></li></ol></div>
        
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">刘绍煌</p>
  <div class="site-description" itemprop="description">刘绍煌的个人博客</div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">54</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">分类</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">56</span>
        <span class="site-state-item-name">标签</span>
        </a>
      </div>
    
  </nav>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">刘绍煌</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.9.0</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.3.0</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="总访客量">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  
    <span class="post-meta-divider">|</span>
  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="总访问量">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>












        
      </div>
    </footer>
  </div>

  


  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="/js/utils.js?v=7.3.0"></script><script src="/js/motion.js?v=7.3.0"></script>
<script src="/js/schemes/pisces.js?v=7.3.0"></script>
<script src="/js/next-boot.js?v=7.3.0"></script>



  





















  

  

  

</body>
</html>
